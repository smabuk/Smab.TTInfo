@page "/print/bracknellscorecard"
@layout PrintLayout

@if (Shaded is false) {
	<style>
		.score-sheet {
			--override-shading-colour: #fff;
			--override-edit-colour: #fff;
		}
	</style>
}

@for (int i = 1; i <= NoOfScoreCards; i++) {
	<div class="score-sheet" data-bordered="@Bordered">
		<div class="header">
			<h1>BRACKNELL, WOKINGHAM & DISTRICT TABLE TENNIS ASSOCIATION</h1>
			<h2>LEAGUE SCORE SHEET</h2>
		</div>

		<div class="main-content">
			<div class="left-panel">
				<div class="top-info">
					<div class="info-field">
						<span class="label">Division</span>
						<span class="dots">@Spaces(23)</span>
						<span class="label">Date</span>
						<span class="dots">@Spaces(23)</span>
						<span class="label">Week No.</span>
						<span class="dots">@Spaces(8)</span>
					</div>
				</div>

				<div class="teams-header">
					<div class="team-line">
						<span class="dots">@Spaces(50)</span>
						<span class="vs">v</span>
						<span class="dots">@Spaces(50)</span>
					</div>
					<div class="team-labels">
						<span class="home-label">Home Team No. & Name</span>
						<span class="away-label">Away Team No. & Name</span>
					</div>
				</div>

				<table class="players-table">
					<thead>
						<tr>
							<th></th>
							<th></th>
							<th>First Name</th>
							<th>Surname</th>
							<th>Won</th>
							<th class="won-cell">Won</th>
						</tr>
					</thead>
					<tbody>
						@foreach ((string homeOrAway, string[] letters) in playerLetters)
						{
							bool homeOrAwayChanged = true;
							foreach (string playerLetter in letters)
							{
								<tr>
									@if (homeOrAwayChanged)
									{
										<td rowspan="3">@homeOrAway</td>
										homeOrAwayChanged = false;
									}
									<td>@playerLetter</td>
									<td></td>
									<td></td>
									@if (playerLetter[0] < 'L')
									{
										<td></td>
										<td class="filled"></td>
									} else
									{
										<td class="filled"></td>
										<td></td>
									}
								</tr>
							}
						}
					</tbody>
					<tfoot>
						<tr>
							<td colspan="3">(½ each for the doubles)</td>
							<td>Result</td>
							<td colspan="2">-</td>
						</tr>
					</tfoot>
				</table>

				<table class="matches-table">
					<thead>
						<tr>
							<th></th>
							<th colspan="5">Scores</th>
							<th>H/A</th>
						</tr>
					</thead>
					<tbody>
						@foreach (MarkupString match in matchOrder) {
							<tr>
								<td data-match="@match">@match</td>
								<td>-</td>
								<td>-</td>
								<td>-</td>
								<td>-</td>
								<td>-</td>
								<td></td>
							</tr>
						}
					</tbody>
				</table>
			</div>

			<div class="right-panel">
				<div class="notes-section">
					<span>Enter notes here:</span>
				</div>
				<div class="info-field">
					<span class="label">Player of the Match:</span>
					<span class="dots">@Spaces(20)</span>
				</div>
				<div class="info-field">
					<span class="label">Match Highlights:</span>
				</div>

				<div class="signature-section">
					<div class="signature-label">Signed:</div>
					<div class="signature-line">
						<span class="fill-dots"></span>
						<div class="caption">Home Team Captain</div>
					</div>
					<div class="signature-line">
						<span class="fill-dots"></span>
						<div class="caption">Away Team Captain</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	@if (i < NoOfScoreCards) {
		<div class="page-break"></div>
	}
}

@code {
	[Parameter, SupplyParameterFromQuery]
	public bool? Bordered { get; set; }

	[Parameter, SupplyParameterFromQuery]
	public bool? Shaded { get; set; }

	[Parameter, SupplyParameterFromQuery]
	public int? NoOfScoreCards { get; set; }

	private (string HomeOrAway, string[] Letters)[] playerLetters = [
		("Home", ["A", "B", "C"]),
		("Away", ["X", "Y", "Z"])
	];

	// Order of matches as per Bracknell League rules
	private string[] matchOrder = ["A v X", "B v Y", "C v Z", "B v X", "A v Z", "v", "C v Y", "B v Z", "C v X", "A v Y"];

	protected override void OnParametersSet()
	{
		NoOfScoreCards ??= 2;
		Bordered ??= false;
		Shaded ??= true;
	}

	private MarkupString Spaces(int count) => (MarkupString)(string.Join("", Enumerable.Repeat("&nbsp;", count)));
}
